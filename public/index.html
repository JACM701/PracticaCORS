<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookSwap API Preview</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        #book-list {
            margin-top: 20px;
        }
        .book-item {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        .book-item img {
            max-width: 100px;
            height: auto;
        }
    </style>
</head>
<body>

    <h1>Previsualización de BookSwap API</h1>

    <!-- Formulario de inicio de sesión -->
    <h2>Iniciar sesión</h2>
    <form id="login-form">
        <label for="username">Usuario:</label>
        <input type="text" id="username" name="username" required><br><br>
        
        <label for="password">Contraseña:</label>
        <input type="password" id="password" name="password" required><br><br>
        
        <button type="submit">Iniciar sesión</button>
    </form>

    <!-- Formulario para añadir un nuevo libro -->
    <h2>Añadir un nuevo libro</h2>
    <form id="add-book-form" enctype="multipart/form-data">
        <label for="titulo">Título:</label>
        <input type="text" id="titulo" name="titulo" required><br><br>
        
        <label for="autor">Autor:</label>
        <input type="text" id="autor" name="autor" required><br><br>
        
        <label for="descripcion">Descripción:</label>
        <textarea id="descripcion" name="descripcion" required></textarea><br><br>
        
        <label for="fecha_publicacion">Fecha de Publicación:</label>
        <input type="text" id="fecha_publicacion" name="fecha_publicacion" required><br><br>
        
        <label for="genero">Género:</label>
        <input type="text" id="genero" name="genero" required><br><br>
        
        <label for="imagen">Imagen:</label>
        <input type="file" id="imagen" name="imagen" accept="image/*"><br><br>
        
        <button type="submit">Añadir Libro</button>
    </form>

    <hr>

    <!-- Listar libros -->
    <h2>Lista de libros</h2>
    <button id="fetch-books">Obtener Libros</button>
    <div id="book-list"></div>

    <!-- Formulario para actualizar un libro -->
    <h2>Actualizar un libro</h2>
    <form id="update-book-form" enctype="multipart/form-data">
        <label for="update-id">ID del libro:</label>
        <input type="number" id="update-id" name="id" required><br><br>
        
        <label for="update-titulo">Nuevo Título:</label>
        <input type="text" id="update-titulo" name="titulo"><br><br>

        <label for="update-autor">Nuevo Autor:</label>
        <input type="text" id="update-autor" name="autor"><br><br>

        <label for="update-descripcion">Nueva Descripción:</label>
        <textarea id="update-descripcion" name="descripcion"></textarea><br><br>

        <label for="update-fecha_publicacion">Nueva Fecha de Publicación:</label>
        <input type="text" id="update-fecha_publicacion" name="fecha_publicacion"><br><br>

        <label for="update-genero">Nuevo Género:</label>
        <input type="text" id="update-genero" name="genero"><br><br>

        <label for="update-imagen">Nueva Imagen:</label>
        <input type="file" id="update-imagen" name="imagen" accept="image/*"><br><br>

        <button type="submit">Actualizar Libro</button>
    </form>

    <!-- Formulario para eliminar un libro -->
    <h2>Eliminar un libro</h2>
    <form id="delete-book-form">
        <label for="delete-id">ID del libro:</label>
        <input type="number" id="delete-id" name="id" required><br><br>
        
        <button type="submit">Eliminar Libro</button>
    </form>

    <script>
        const API_URL = 'https://api-bookswap.onrender.com/books'; // Cambia la URL a la de producción
    
        // Iniciar sesión y obtener el token
        document.getElementById('login-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
    
            try {
                const response = await fetch('https://api-bookswap.onrender.com/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password }),
                });
                const data = await response.json();
    
                if (response.ok) {
                    localStorage.setItem('token', data.token); // Guarda el token en localStorage
                    alert('Inicio de sesión exitoso');
                } else {
                    alert(data.message || 'Error al iniciar sesión');
                }
            } catch (error) {
                console.error('Error al iniciar sesión:', error);
            }
        });
    
        // Añadir un nuevo libro
        document.getElementById('add-book-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            const token = localStorage.getItem('token'); // Obtén el token
    
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + token, // Agrega el token en los headers
                    },
                    body: formData
                });
                const result = await response.json();
                alert(result.message);
                if (response.ok) {
                    this.reset(); // Reiniciar el formulario después de añadir un libro
                }
            } catch (error) {
                console.error('Error al añadir libro:', error);
            }
        });
    
        // Obtener la lista de libros
        document.getElementById('fetch-books').addEventListener('click', async function() {
            const token = localStorage.getItem('token'); // Obtén el token
    
            try {
                const response = await fetch(API_URL, {
                    headers: {
                        'Authorization': 'Bearer ' + token, // Agrega el token en los headers
                    }
                });
                const books = await response.json();
                
                const bookList = document.getElementById('book-list');
                bookList.innerHTML = ''; // Limpiar lista
                
                books.forEach(book => {
                    const bookItem = document.createElement('div');
                    bookItem.classList.add('book-item');
                    
                    bookItem.innerHTML = `
                        <div>
                            <h3>${book.titulo}</h3>
                            <p><strong>Autor:</strong> ${book.autor}</p>
                            <p><strong>Descripción:</strong> ${book.descripcion}</p>
                            <p><strong>Género:</strong> ${book.genero}</p>
                            <p><strong>Fecha de Publicación:</strong> ${book.fecha_publicacion}</p>
                        </div>
                        ${book.imagen ? `<img src="${book.imagen}" alt="${book.titulo}">` : ''}
                    `;
                    bookList.appendChild(bookItem);
                });
            } catch (error) {
                console.error('Error al obtener libros:', error);
            }
        });
    
        // Actualizar un libro
        document.getElementById('update-book-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const id = document.getElementById('update-id').value;
            const formData = new FormData(this);
            const token = localStorage.getItem('token'); // Obtén el token
    
            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': 'Bearer ' + token, // Agrega el token en los headers
                    },
                    body: formData
                });
                const result = await response.json();
                alert(result.message);
                if (response.ok) {
                    this.reset(); // Reiniciar el formulario después de actualizar
                }
            } catch (error) {
                console.error('Error al actualizar libro:', error);
            }
        });
    
        // Eliminar un libro
        document.getElementById('delete-book-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const id = document.getElementById('delete-id').value;
            const token = localStorage.getItem('token'); // Obtén el token
    
            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': 'Bearer ' + token, // Agrega el token en los headers
                    }
                });
                const result = await response.json();
                alert(result.message);
            } catch (error) {
                console.error('Error al eliminar libro:', error);
            }
        });
    </script>
    
</body>
</html>
