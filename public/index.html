<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Books API Frontend</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">

  <div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold text-center mb-6">Books API</h1>

    <!-- Formulario para agregar o actualizar libros -->
    <div class="mb-6 p-4 bg-white shadow rounded">
      <h2 class="text-xl font-semibold mb-4">Add / Update Book</h2>
      <form id="bookForm" class="space-y-4">
        <div>
          <label for="bookId" class="block text-sm font-medium">Book ID (for updates only)</label>
          <input type="number" id="bookId" class="mt-1 block w-full border-gray-300 shadow-sm rounded-md" placeholder="Leave empty for new books">
        </div>
        <div>
          <label for="title" class="block text-sm font-medium">Title</label>
          <input type="text" id="title" class="mt-1 block w-full border-gray-300 shadow-sm rounded-md" required>
        </div>
        <div>
          <label for="author" class="block text-sm font-medium">Author</label>
          <input type="text" id="author" class="mt-1 block w-full border-gray-300 shadow-sm rounded-md" required>
        </div>
        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Submit</button>
      </form>
    </div>

    <!-- Tabla de libros -->
    <div class="p-4 bg-white shadow rounded">
      <h2 class="text-xl font-semibold mb-4">Books List</h2>
      <table class="w-full border-collapse border border-gray-300">
        <thead>
          <tr class="bg-gray-200">
            <th class="border border-gray-300 px-4 py-2">ID</th>
            <th class="border border-gray-300 px-4 py-2">Title</th>
            <th class="border border-gray-300 px-4 py-2">Author</th>
            <th class="border border-gray-300 px-4 py-2">Actions</th>
          </tr>
        </thead>
        <tbody id="booksTable" class="text-center"></tbody>
      </table>
    </div>
  </div>

  <script>
    const apiBaseUrl = "https://api-bookswap.onrender.com"; // URL de tu API en Render

    // Cargar libros al iniciar
    document.addEventListener("DOMContentLoaded", fetchBooks);

    // Obtener lista de libros
    async function fetchBooks() {
      try {
        const response = await fetch(`${apiBaseUrl}/books`);
        const books = await response.json();

        const booksTable = document.getElementById("booksTable");
        booksTable.innerHTML = ""; // Limpiar tabla

        books.forEach(book => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td class="border border-gray-300 px-4 py-2">${book.id}</td>
            <td class="border border-gray-300 px-4 py-2">${book.title}</td>
            <td class="border border-gray-300 px-4 py-2">${book.author}</td>
            <td class="border border-gray-300 px-4 py-2">
              <button onclick="deleteBook(${book.id})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">Delete</button>
            </td>
          `;
          booksTable.appendChild(row);
        });
      } catch (error) {
        console.error("Error fetching books:", error);
      }
    }

    // Manejar el formulario para agregar/actualizar libros
    const bookForm = document.getElementById("bookForm");
    bookForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const id = document.getElementById("bookId").value;
      const title = document.getElementById("title").value;
      const author = document.getElementById("author").value;

      const bookData = { title, author };
      const endpoint = id ? `${apiBaseUrl}/books/${id}` : `${apiBaseUrl}/books`;

      try {
        const response = await fetch(endpoint, {
          method: id ? "PUT" : "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(bookData),
        });

        if (response.ok) {
          alert(id ? "Book updated successfully!" : "Book added successfully!");
          bookForm.reset();
          fetchBooks();
        } else {
          throw new Error("Error adding/updating book");
        }
      } catch (error) {
        console.error(error);
      }
    });

    // Eliminar libro
    async function deleteBook(id) {
      if (!confirm("Are you sure you want to delete this book?")) return;

      try {
        const response = await fetch(`${apiBaseUrl}/books/${id}`, { method: "DELETE" });

        if (response.ok) {
          alert("Book deleted successfully!");
          fetchBooks();
        } else {
          throw new Error("Error deleting book");
        }
      } catch (error) {
        console.error(error);
      }
    }
  </script>
</body>
</html>
